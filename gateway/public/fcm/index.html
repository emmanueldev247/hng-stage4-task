<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FCM Token Console</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: dark;
        --bg: #05060a;
        --panel: rgba(13, 16, 30, 0.8);
        --panel-border: rgba(255, 255, 255, 0.2);
        --accent: #7f5af0;
        --accent-strong: #ff5470;
        --text: #f9f9fb;
        --muted: #9ea3c0;
        --success: #6ce9a6;
        font-family:
          'Space Grotesk',
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background:
          radial-gradient(
            circle at top,
            rgba(127, 90, 240, 0.25),
            transparent 55%
          ),
          radial-gradient(
            circle at bottom,
            rgba(255, 84, 112, 0.2),
            transparent 50%
          ),
          var(--bg);
        color: var(--text);
        padding: 2rem;
      }

      .panel {
        width: min(720px, 100%);
        border-radius: 32px;
        padding: 3rem clamp(1.5rem, 4vw, 3rem);
        position: relative;
        background: var(--panel);
        border: 1px solid var(--panel-border);
        backdrop-filter: blur(20px);
        box-shadow: 0 20px 80px rgba(9, 8, 20, 0.75);
      }

      .panel::after {
        content: '';
        position: absolute;
        inset: 2px;
        border-radius: 30px;
        background: linear-gradient(
          135deg,
          rgba(127, 90, 240, 0.2),
          rgba(255, 84, 112, 0.15)
        );
        z-index: -1;
      }

      h1 {
        font-size: clamp(2.5rem, 5vw, 3rem);
        margin: 0 0 0.5rem;
      }

      p {
        margin: 0 0 1.75rem;
        color: var(--muted);
        max-width: 52ch;
        line-height: 1.5;
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 0.95rem 2.8rem;
        font-size: 1rem;
        font-weight: 600;
        color: #fff;
        background: linear-gradient(
          120deg,
          var(--accent),
          var(--accent-strong)
        );
        cursor: pointer;
        transition:
          transform 200ms ease,
          box-shadow 200ms ease,
          filter 200ms ease;
        box-shadow: 0 15px 30px rgba(127, 90, 240, 0.4);
      }

      button:active {
        transform: scale(0.98);
        box-shadow: 0 8px 18px rgba(127, 90, 240, 0.4);
      }

      button:hover {
        filter: brightness(1.05);
      }

      .token-box {
        margin-top: 1.75rem;
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        background: rgba(255, 255, 255, 0.02);
        padding: 1.2rem 1.5rem;
        cursor: pointer;
        transition:
          border-color 150ms ease,
          background 150ms ease;
        position: relative;
      }

      .token-box::after {
        content: attr(data-tip);
        position: absolute;
        right: 1.5rem;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.85rem;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        color: var(--muted);
      }

      .token-box:hover {
        border-color: rgba(127, 90, 240, 0.7);
        background: rgba(127, 90, 240, 0.08);
      }

      .token-box.copied {
        border-color: rgba(108, 233, 166, 0.8);
        background: rgba(108, 233, 166, 0.1);
      }

      .token-box.copied::after {
        content: 'copied!';
        color: var(--success);
      }

      .token-label {
        margin: 0;
        font-size: 0.8rem;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        color: var(--muted);
      }

      .token-value {
        margin: 0.5rem 0 0;
        font-family: 'JetBrains Mono', 'SFMono-Regular', Consolas, monospace;
        font-size: 0.95rem;
        word-break: break-all;
        color: var(--text);
      }

      .token-box.hidden {
        display: none;
      }

      .next-steps {
        margin-top: 1.2rem;
        padding: 1.5rem;
        border-radius: 18px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.03);
      }

      .next-steps.hidden {
        display: none;
      }

      .next-steps h2 {
        margin: 0 0 0.5rem;
        font-size: 0.95rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--muted);
      }

      .steps-grid {
        display: grid;
        gap: 1rem;
      }

      .step-card {
        border-radius: 14px;
        padding: 1rem;
        background: rgba(5, 6, 10, 0.5);
        border: 1px solid rgba(127, 90, 240, 0.2);
      }

      .step-card strong {
        display: block;
        font-size: 0.95rem;
        color: var(--text);
      }

      .step-card code {
        display: block;
        margin-top: 0.35rem;
        padding: 0.6rem;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.04);
        font-size: 0.85rem;
        word-break: break-word;
      }

      .terminal {
        margin-top: 2rem;
        background: rgba(5, 6, 10, 0.8);
        border-radius: 24px;
        border: 1px solid var(--panel-border);
        padding: 1.5rem;
        font-family: 'JetBrains Mono', 'SFMono-Regular', Consolas, monospace;
        min-height: 180px;
        max-height: 330px;
        overflow: auto;
        white-space: pre-wrap;
      }

      .terminal::before {
        content: 'live feed';
        text-transform: uppercase;
        letter-spacing: 0.2em;
        font-size: 0.65rem;
        color: var(--muted);
        display: block;
        margin-bottom: 0.85rem;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        border-radius: 999px;
        padding: 0.4rem 1rem;
        font-size: 0.85rem;
        letter-spacing: 0.02em;
        color: var(--success);
        background: rgba(108, 233, 166, 0.1);
        border: 1px solid rgba(108, 233, 166, 0.3);
        margin-bottom: 1.2rem;
      }

      .pill span {
        width: 8px;
        height: 8px;
        background: var(--success);
        border-radius: 50%;
      }

      @media (max-width: 540px) {
        .panel {
          padding: 2rem 1.4rem;
        }

        button {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <main class="panel">
      <div class="pill"><span></span>fcm ready</div>
      <h1>Request your secure FCM token</h1>
      <p>
        Tap the button to grant notification access and spin up a fresh Firebase
        Cloud Messaging token for the gateway service. Copy it straight from
        the live terminal below.
      </p>
      <button id="getTokenBtn">Request permission & fetch token</button>
      <div id="tokenBox" class="token-box hidden" data-tip="click to copy">
        <p class="token-label">latest token</p>
        <p class="token-value" id="tokenValue">---</p>
      </div>
      <section id="nextSteps" class="next-steps hidden">
        <h2>next steps</h2>
        <div class="steps-grid">
          <div class="step-card">
            <strong>Option A · include token during registration</strong>
            <code
              >POST /api/v1/register {"push_token":"&lt;paste token&gt;"}</code
            >
          </div>
          <div class="step-card">
            <strong>Option B · attach token to an existing profile</strong>
            <code
              >POST /api/v1/users/devices {"device_token":"&lt;paste
              token&gt;"}</code
            >
          </div>
        </div>
      </section>
      <pre id="out" class="terminal"></pre>
    </main>
    <script type="module">
      import 'https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js';
      import 'https://www.gstatic.com/firebasejs/10.13.1/firebase-messaging-compat.js';

      const firebaseConfig = {
        apiKey: 'AIzaSyCcJEYYL-K3VymRG4b1AOUPlRKSYxHHEW0',
        authDomain: 'hng-notifications.firebaseapp.com',
        projectId: 'hng-notifications',
        storageBucket: 'hng-notifications.firebasestorage.app',
        messagingSenderId: '393678055022',
        appId: '1:393678055022:web:cda5a5b708b5990715e87f',
        measurementId: 'G-LS7007L339',
      };

      const VAPID_KEY =
        'BGz5SU5Eoo8RsP8PXus5J0szqlHYIibbm5aHaKRg7H75mF6ck2h-tN42V3XLdNkrvrlfZAlqGSkfIMitNyAx6aQ';

      firebase.initializeApp(firebaseConfig);
      const messaging = firebase.messaging();

      window.messaging = messaging;
      window.VAPID_KEY = VAPID_KEY;

      const out = document.getElementById('out');
      const tokenBox = document.getElementById('tokenBox');
      const tokenValue = document.getElementById('tokenValue');
      const nextSteps = document.getElementById('nextSteps');
      const log = (m) => (out.textContent += m + '\n');

      const copyToken = async () => {
        if (!tokenValue || !tokenBox || tokenValue.textContent === '---')
          return;
        try {
          await navigator.clipboard.writeText(tokenValue.textContent.trim());
          tokenBox.classList.add('copied');
          setTimeout(() => tokenBox.classList.remove('copied'), 2000);
        } catch (copyError) {
          log('Clipboard copy failed. Please copy manually.');
          console.error(copyError);
        }
      };

      tokenBox?.addEventListener('click', copyToken);

      navigator.serviceWorker
        .register('/fcm/firebase-messaging-sw.js')
        .then(async (reg) => {
          log('Service worker registered.');
          document.getElementById('getTokenBtn').onclick = async () => {
            try {
              const perm = await Notification.requestPermission();
              log('Notification permission: ' + perm);
              if (perm !== 'granted') return;

              const token = await messaging.getToken({
                vapidKey: VAPID_KEY,
                serviceWorkerRegistration: reg,
              });

              if (token) {
                log('Token generated successfully. Check the cards above.');
                if (tokenBox && tokenValue) {
                  tokenValue.textContent = token;
                  tokenBox.classList.remove('hidden');
                  tokenBox.classList.remove('copied');
                }
                if (nextSteps) {
                  nextSteps.classList.remove('hidden');
                }
              } else {
                log('No token returned. Check notification permissions.');
              }
            } catch (e) {
              console.error(e);
              log('Error: ' + (e?.message || e));
            }
          };
        });
    </script>
  </body>
</html>
